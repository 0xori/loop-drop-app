<? require './piano.js' as piano ?>

<div class='Node -source' t:repeat='sources' t:by='.type' t:bind:data-path=':path'>
  <div class='.controls'>
    <a href='#' class='.delete' data-behavior='editor.nodes.deleteButton'>X</a>
  </div>
  <t:placeholder t:when='sample'>
    <div class='.title' t:bind='.url|:text(empty sample)' />
    <div 
      class='SampleTrimmer' 
      t:bind:data-in='.offset[0]' 
      t:bind:data-out='.offset[1]' 
      t:bind:data-gain='.amp'
      t:bind:data-url='.url' 
      data-behavior='editor.sampleTrimmer' 
    />
  </t:placeholder>

  <t:placeholder t:when='oscillator'>
    <div class='.title'>Oscillator</div>
    <div class='.body'>

      <div>
        <div class='.title'>Shape</div>
        <select 
          data-behavior='editor.nodes.select' 
          t:bind:data-value='.shape|:text(sine)' 
          t:bind:data-path=':path(shape)'>

          <option value='sine'>Sine</option>
          <option value='square'>Square</option>
          <option value='sawtooth'>Sawtooth</option>
          <option value='triangle'>Triangle</option>
        </select>
      </div>

      <div>
        <div class='.title'>Frequency</div>
        <span t:bind='.frequency|:text(440)' />hz
      </div>

      <div>
        <div class='.title'>Scale</div>
        <select 
          data-behavior='editor.nodes.scaleSelector' 
          t:bind:data-value='.note:scale' 
          t:bind:data-path=':path(note)'>

          <option value=''>None</option>
          <option value='major'>Major</option>
          <option value='minor'>Minor</option>
          <option value='dorian'>Dorian</option>
          <option value='phrygian'>Phrygian</option>
          <option value='lydian'>Lydian</option>
          <option value='mixolydian'>Mixolydian</option>
          <option value='locrian'>Locrian</option>
          <option value='majorpentatonic'>Major Pentatonic</option>
          <option value='chromatic'>Chromatic</option>

        </select>
      </div>

      <div>
        <div class='.title'>Amp</div>
        <span t:bind='.amp:dB(unit)' />
      </div>
    </div>

    <div class='Piano' 
      t:bind='.note'
      t:bind:data-path=':path(note, root)'
      data-behavior='editor.noteChooser'
      t:view='piano'
    />

  </t:placeholder>
</div>
  
<div 
  t:unless='sources:isLinked' 
  data-behavior='editor.nodes.spawner' 
  data-path='sources' 
  class='.spawner -source'>

  <a href='#' data-type='sample'>sample</a>
  <a href='#' data-type='oscillator'>oscillator</a>
</div>

<div class='Node -processor' t:repeat='processors' t:by='.type' t:bind:data-path=':path'>
  <div class='.controls'>
    <a href='#' class='.delete' data-behavior='editor.nodes.deleteButton'>X</a>
  </div>
  <t:placeholder t:when='filter'>
    <div class='.title'>Filter</div>
    <div>
      <table>
        <td>Kind</td>
        <td>
          <select data-behavior='editor.nodes.select' t:bind:data-value='.kind|:text(lowpass)' t:bind:data-path=':path(kind)'>
            <option value='lowpass'>Lowpass</option>
            <option value='highpass'>Highpass</option>
          </select>
        </td>
      </table>
    </div>
  </t:placeholder>

  <t:placeholder t:when='overdrive'>
    <div class='.title'>Overdrive</div>
  </t:placeholder>

  <t:placeholder t:when='delay'>
    <div class='.title'>Delay</div>
  </t:placeholder>

  <t:placeholder t:when='gain'>
    <div class='.title'>Gain</div>
  </t:placeholder>

</div>

<div 
  t:unless='sources:isLinked' 
  data-behavior='editor.nodes.spawner' 
  data-path='processors' class='.spawner -processor'>

  <a href='#' data-type='filter'>filter</a>
  <a href='#' data-type='overdrive'>overdrive</a>
  <a href='#' data-type='delay'>delay</a>
  <a href='#' data-type='gain'>gain</a>

</div>

<div class='Node -output' t:by='.type'>
  <div class='.title'>Output</div>
  <select data-behavior='editor.nodes.select' t:bind:data-value='.output' t:bind:data-path=':path(output)'>
    <option value=''>Master</option>
    <option value='A'>Bus A</option>
    <option value='B'>Bus B</option>
    <option value='C'>Bus C</option>
    <option value='D'>Bus D</option>
    <option value='E'>Bus E</option>
    <option value='F'>Bus F</option>
    <option value='G'>Bus G</option>
    <option value='H'>Bus H</option>
  </select>
</div>